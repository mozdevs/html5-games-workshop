<!DOCTYPE html>
<head>
  <title>HTML5 Games Workshop - Animations for the main character</title>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="stylesheet" href="../../../../css/styles.css"/>
  <link rel="stylesheet" href="../../../../vendor/prism/prism.css"/>
  <script src="../../../../vendor/prism/prism.js"></script>
</head>
<body>
  <header class="main-header">
    <h1><a href="../../../..">HTML5 Games Workshop</a></h1>
  </header>
  <main>
    <article>
      <h1>Animations for the main character</h1><p>Right now we have a few animated sprites in the game: the coins and the enemy spiders. But none for the main character! We are going to implement them now.</p>
<p>This is the character&#39;s spritesheet and the animations in it:</p>
<p><img src="/html5-games-workshop/assets/platformer/hero_spritesheet.png" alt="Main character spritesheet"/></p>
<ul>
<li>Stopped: frame #0</li>
<li>Running: frames #1 - #2</li>
<li>Jumping (upwards): frame #3</li>
<li>Falling: frame #4</li>
</ul>
<p><small>There&#39;s also a dying/hit animation in the spritesheet, but we will implement it in a later stage.</small></p>
<p>As you can see, this can be a bit complex, so the approach that we will follow to handle animations for the main character is to <strong>check every frame</strong> which animation should be active and, if it&#39;s different, we&#39;ll play another one.</p>
<h2 id="tasks">Tasks</h2>
<h3 id="add-the-new-animations">Add the new animations</h3>
<ol>
<li><p>Previously we had <code>hero_stopped.png</code> assigned to the <code>hero</code> key, loaded as an image. We need to get rid of that, so <strong>delete this line</strong> in the <code>preload</code>:</p>
<pre><code class="lang-js"> PlayState.preload = function () {
     // delete this line below
     this.game.load.image(&#39;hero&#39;, &#39;images/hero_stopped.png&#39;);
 };
</code></pre>
</li>
<li><p>Now we need to load the new spritesheet into the <code>hero</code> key:</p>
<pre><code class="lang-js"> PlayState.preload = function () {
     // ...
     this.game.load.spritesheet(&#39;hero&#39;, &#39;images/hero.png&#39;, 36, 42);
     // ...
 };
</code></pre>
</li>
<li><p>Add the new animations in the <code>Hero</code> constructor:</p>
<pre><code class="lang-js"> function Hero(game, x, y) {
     // ...
     this.animations.add(&#39;stop&#39;, [0]);
     this.animations.add(&#39;run&#39;, [1, 2], 8, true); // 8fps looped
     this.animations.add(&#39;jump&#39;, [3]);
     this.animations.add(&#39;fall&#39;, [4]);
 }
</code></pre>
</li>
</ol>
<h3 id="calculate-which-animation-should-be-playing">Calculate which animation should be playing</h3>
<ol>
<li><p>This is the new <code>Hero</code> method that will return the <em>name</em> of the animation that should be playing:</p>
<pre><code class="lang-js"> Hero.prototype._getAnimationName = function () {
     let name = &#39;stop&#39;; // default animation

     // jumping
     if (this.body.velocity.y &lt; 0) {
         name = &#39;jump&#39;;
     }
     // falling
     else if (this.body.velocity.y &gt;= 0 &amp;&amp; !this.body.touching.down) {
         name = &#39;fall&#39;;
     }
     else if (this.body.velocity.x !== 0 &amp;&amp; this.body.touching.down) {
         name = &#39;run&#39;;
     }

     return name;
 };
</code></pre>
<p> Note how in the <em>falling</em> state we are both checking that the vertical velocity is positive (it goes downwards) <em>and</em> that the main character is not touching a platform. Why? Because when the character is on the ground it still has a vertical velocity caused by <strong>the gravity</strong>. The character doesn&#39;t fall because there is a body blocking them, not because their vertical velocity is zero.</p>
</li>
<li><p>We will create an <code>update</code> method for <code>Hero</code> in which we will check which animation should be playing and switch to a new one if necessary. Remember that <code>update</code> methods in <code>Phaser.Sprite</code> instances get called automatically each frame!</p>
<pre><code class="lang-js"> Hero.prototype.update = function () {
     // update sprite animation, if it needs changing
     let animationName = this._getAnimationName();
     if (this.animations.name !== animationName) {
         this.animations.play(animationName);
     }
 };
</code></pre>
</li>
<li><p>Try it now in the browser! Run, jump around… You should be able to see all the animations in place. <em>And</em> a little glitch: the character <strong>does not face</strong> the right direction when moving left.</p>
<p> <img src="/html5-games-workshop/assets/platformer/hero_animation_glitch.gif" alt="Animations… with a glitch!"/></p>
</li>
</ol>
<h3 id="make-the-character-face-the-right-direction">Make the character face the right direction</h3>
<ol>
<li><p>It may sound weird, but usually in game development <strong>flipping</strong> (or mirroring) an image is achieved by applying a <strong>negative scale</strong> to the image. So applying a scale of <code>-100%</code> horizontally will flip the image of the character to face to the left.</p>
<p> Add this to the <code>move</code> method, since we know the direction in that moment:</p>
<pre><code class="lang-js"> Hero.prototype.move = function (direction) {
     // ...
     if (this.body.velocity.x &lt; 0) {
         this.scale.x = -1;
     }
     else if (this.body.velocity.x &gt; 0) {
         this.scale.x = 1;
     }
 };
</code></pre>
<p> <small>In Phaser scales are normalized, so <code>0.5</code> means <code>50%</code>, <code>1</code> means <code>100%</code> and so on.</small></p>
</li>
</ol>
<p>The final result is the main character facing the right direction when moving.</p>
<p><img src="/html5-games-workshop/assets/platformer/hero_animations.gif" alt="Main character, properly animated"/></p>
<h2 id="checklist">Checklist</h2>
<ul>
<li>The main character shows different animations or images for the following actions: not moving, running, jumping and falling.</li>
<li>The main character faces the correct direction when moving either left or right.</li>
</ul>

      <h2>Download</h2>
      <p>Are you stuck? Take a look at <a href="../../../../assets/platformer/steps/step13.js" download="">the source code</a> for this step.
      </p>
      <nav class="paginated-nav">
        <ul>
          <li class="previous">« Previous:&nbsp;<a href="../scoreboard">Scoreboard</a></li>
          <li class="next">Next:&nbsp;<a href="../win-condition">Win condition</a>&nbsp;»</li>
        </ul>
      </nav>
    </article>
  </main>
  <footer class="main-footer">
    <p>With love,<br/>the game dev fairies at <a href="https://mozilla.org">Mozilla</a>.</p>
  </footer>
</body>