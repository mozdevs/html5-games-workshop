<!DOCTYPE html>
<head>
  <title>HTML5 Games Workshop - Creating platforms</title>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link rel="stylesheet" href="../../../../css/styles.css"/>
  <link rel="stylesheet" href="../../../../vendor/prism/prism.css"/>
  <script src="../../../../vendor/prism/prism.js"></script>
</head>
<body>
  <header class="main-header">
    <h1><a href="../../../..">HTML5 Games Workshop</a></h1>
  </header>
  <main>
    <article>
      <h1>Creating platforms</h1><p>A platformer game needs… platforms, right? There are multiple techniques to handling platforms and the physics related to them. In this workshop, we will consider the platforms as <strong>sprites</strong>, like other characters in the game.</p>
<p><small>There are more efficient and flexible ways to do this, but for a one-screen platformer, this one is performant enough and, more importantly, the <em>most simple way</em>.</small></p>
<p>This is how some of the platforms look like (a 4✕1 and a 1✕1):</p>
<p><img src="/html5-games-workshop/assets/platformer/grass_4x1.png" alt="4x1 grass platform"/> <img src="/html5-games-workshop/assets/platformer/grass_1x1.png" alt="1x1 grass platform"/></p>
<p>As with images, there is a factory method to create <strong>sprites</strong> (in this case, instances of <a href="http://phaser.io/docs/2.6.2/Phaser.Sprite.html"><code>Phaser.Sprite</code></a>) and add them automatically to the game world.</p>
<p>But <em>where</em> to place the platforms? We could hardcode the whole thing, but in the long run it&#39;s better to have the level data in a separate file that we can load. We have some <strong>level data as JSON</strong> files in the <code>data/</code> folder.</p>
<p><small>Ideally, these files would be generated with a level editor tool, but you can add more levels to the game after the workshop by creating your own JSON files!</small></p>
<p>If you open one of these JSON files, you can see how platform data is specified:</p>
<pre><code class="lang-js">{
    &quot;platforms&quot;: [
        {&quot;image&quot;: &quot;ground&quot;, &quot;x&quot;: 0, &quot;y&quot;: 546},
        {&quot;image&quot;: &quot;grass:4x1&quot;, &quot;x&quot;: 420, &quot;y&quot;: 420}
    ],
    // ....
}
</code></pre>
<h2 id="tasks">Tasks</h2>
<h3 id="load-the-level-data">Load the level data</h3>
<ol>
<li><p>Phaser considers JSON files as another type of asset with can load within the game. Let&#39;s load the level data in the <code>preload</code> method:</p>
<pre><code class="lang-js"> PlayState.preload = function () {
     this.game.load.json(&#39;level:1&#39;, &#39;data/level01.json&#39;);
     // ...
 };
</code></pre>
</li>
<li><p>Now modify <code>create</code>:</p>
<pre><code class="lang-js"> PlayState.create = function () {
     //...
     this._loadLevel(this.game.cache.getJSON(&#39;level:1&#39;));
 };

 PlayState._loadLevel = function (data) {
 };
</code></pre>
</li>
</ol>
<p>You can check this works if you add a <code>console.log(data)</code> in <code>PlayState._loadLevel</code> –and don&#39;t forget to remove it afterwards.</p>
<h3 id="spawn-platform-sprites">Spawn platform sprites</h3>
<ol>
<li><p>Before creating the sprites, we need to load the images that the platforms will use. As usual, we do this in the <code>preload</code> method:</p>
<pre><code class="lang-js"> PlayState.preload = function () {
     // ...
     this.game.load.image(&#39;ground&#39;, &#39;images/ground.png&#39;);
     this.game.load.image(&#39;grass:8x1&#39;, &#39;images/grass_8x1.png&#39;);
     this.game.load.image(&#39;grass:6x1&#39;, &#39;images/grass_6x1.png&#39;);
     this.game.load.image(&#39;grass:4x1&#39;, &#39;images/grass_4x1.png&#39;);
     this.game.load.image(&#39;grass:2x1&#39;, &#39;images/grass_2x1.png&#39;);
     this.game.load.image(&#39;grass:1x1&#39;, &#39;images/grass_1x1.png&#39;);
 };
</code></pre>
</li>
<li><p>Now let&#39;s spawn the platforms. The level JSON file contains a <code>platform</code> property with an <code>Array</code> of the info necessary to spawn the platforms: their position, and the image. So we just need to iterate over this <code>Array</code> and add new sprites to the game world:</p>
<pre><code class="lang-js"> PlayState._loadLevel = function (data) {
     // spawn all platforms
     data.platforms.forEach(this._spawnPlatform, this);
 };

 PlayState._spawnPlatform = function (platform) {
     this.game.add.sprite(platform.x, platform.y, platform.image);
 };
</code></pre>
<p> <small>If you are thinking why we are splitting this into different methods, it&#39;s because <code>_loadLevel</code> will become very crowded in the following steps.</small></p>
</li>
</ol>
<p>Refresh your browser and you should see our platform sprites!</p>
<p><img src="/html5-games-workshop/assets/platformer/step02_check.png" alt="Platform sprites"/></p>
<h2 id="checklist">Checklist</h2>
<ul>
<li>You can see platforms rendered over the background</li>
<li>Make sure you are using <code>game.add.sprite</code> to create the platforms and <em>not</em> <code>game.add.image</code>!</li>
</ul>

      <h2>Download</h2>
      <p>Are you stuck? Take a look at <a href="../../../../assets/platformer/steps/step03.js" download="">the source code</a> for this step.
      </p>
      <nav class="paginated-nav">
        <ul>
          <li class="previous">« Previous:&nbsp;<a href="../the-game-loop">The game loop</a></li>
          <li class="next">Next:&nbsp;<a href="../the-main-character-sprite">The main character sprite</a>&nbsp;»</li>
        </ul>
      </nav>
    </article>
  </main>
  <footer class="main-footer">
    <p>With love,<br/>the game dev fairies at <a href="https://mozilla.org">Mozilla</a>.</p>
  </footer>
</body>